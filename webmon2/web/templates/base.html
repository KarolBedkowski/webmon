<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>Webmon2 {% block title %}{% endblock %}</title>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<style type="text/css">
			body{margin: 2em auto;max-width:80ch;color:#444;font-family:sans-serif;line-height: 1.5;}
			a{color: #222;}
			h1,h2,h3{color: #333;margin: 1em 0 0 0}
			h4{color: #333;margin: 0}
			pre{background: #eee;padding: 1em;}
			article header nav {font-size: 80%;margin: 0}
			article header nav a {font-size: 80%;margin: 0}
			article {border: 1px solid #ccc;margin: 0.5em; padding: 0.2em 0.5em;}
			input{ height: 1em;}
			input,textarea,select {width: 75%;}
			label {width: 20%; display: inline-block; vertical-align: top;}
			nav a {margin-right: 2em}
			section > header nav {margin-bottom: 2em; border-bottom: 1px solid #ccc;}
			section > footer nav {margin-top: 2em; border-top: 1px solid #ccc;}
			.flash{width: 75%; background-color: #eef; padding: 1em;margin: 0 auto;border-radius: 5px;}
			.error{width: 75%; background-color: #fee; padding: 1em;margin: 0 auto;}
			article[data-state=read] {background-color: #eee;}
			article[data-state=read] a[data-action=mark_read]:before{content: "✔︎ Read";}
			article[data-state=unread] a[data-action=mark_read]:before{content: "✘ Unread";}
			article[data-starred=star] a[data-action=mark_star]:before{content: "★ Starred"; font-weight: bold}
			article[data-starred=unstar] a[data-action=mark_star]:before{content: "☆ Star";}
			article[data-starred=star] {border-color: red; border-width: 2px;}
			.group-tag{background-color: #ff9;border: 1px solid black; font-size: 75%; padding: 0.2em; text-decoration: None;margin-left:1em; float: right;border-radius: 4px;}
		</style>
		{% block styles %}{% endblock %}
	</head>
	<body>
		<header id="main-header">
			<nav>
				<a href="{{ url_for("browser.entries_unread") }}">Entries</a>
				<a href="{{ url_for("browser.entries_starred") }}">Starred</a>
				<a href="{{ url_for("browser.sources") }}">Sources</a>
				<a href="{{ url_for("browser.groups") }}">Groups</a>
				<a href="{{ url_for("system.settings") }}">Settings</a>
				<a href="{{ url_for("sec.logout") }}">Logout</a>
			</nav>
		</header>
		<section id="flashes">
			{% for message in get_flashed_messages() %}
			<div class="flash">{{ message }}</div>
			{% endfor %}
		</section>
		<section class="content">
			<header>
				{% block header %}{% endblock %}
			</header>
			{% block content %}{% endblock %}
			<footer>
				{% block footer %}{% endblock %}
			</footer>
		</section>
	</body>
	<script type="text/javascript">
		document.addEventListener("DOMContentLoaded", function() {
			let mark_read_url = "{{ url_for("browser.entry_mark_read_api") }}";
			document.querySelectorAll("a[data-action=mark_read]").forEach((element) => {
				element.onclick = (event) => {
					event.preventDefault();
					let formData = new FormData();
					let article = element.closest('article');
					formData.append("entry_id", article.dataset["entryId"]);
					if (article.dataset["state"] == "read") {
						formData.append("value", "unread");
					} else {
						formData.append("value", "read");
					}
					element.attributes['href'] = "";
					fetch(mark_read_url, {
						method: "POST",
						body: formData,
					})
					.then((resp) => {
						return resp.text();
					})
					.then((data) => {
						if (data == "read" || data == "unread") {
							article.dataset["state"] = data;
						}
						element.attributes['href'] = "#";
					})
					.catch((error) => {
						window.console.log(error);
						element.attributes['href'] = "#";
					});
				};
			});
			let mark_star_url = "{{ url_for("browser.entry_mark_star_api") }}";
			document.querySelectorAll("a[data-action=mark_star]").forEach((element) => {
				element.onclick = (event) => {
					event.preventDefault();
					let formData = new FormData();
					let article = element.closest('article');
					formData.append("entry_id", article.dataset["entryId"]);
					if (article.dataset["starred"] == "star") {
						formData.append("value", "unstar");
					} else {
						formData.append("value", "star");
					}
					element.attributes['href'] = "";
					fetch(mark_star_url, {
						method: "POST",
						body: formData,
					})
					.then((resp) => {
						return resp.text();
					})
					.then((data) => {
						if (data == "star" || data == "unstar") {
							article.dataset["starred"] = data;
						}
						element.attributes['href'] = "#";
					})
					.catch((error) => {
						window.console.log(error);
						element.attributes['href'] = "#";
					});
				};
			});
			document.querySelectorAll("a[data-req-confirm=yes]").forEach((element) => {
				element.onclick = (event) => {
					if (!confirm("Realy?")) {
						event.preventDefault()
					}
				};
			});
		});
	</script>
	{% block scripts %}{% endblock %}
</html>
